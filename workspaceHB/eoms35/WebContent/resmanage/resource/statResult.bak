<%@page contentType="text/html;charset=gb2312"%>
<%@page import="com.boco.query.*"%>
<%@page import="com.boco.entity.*"%>
<%@page import="mcs.common.db.*"%>
<%@page import="java.util.*"%>
<%
/**
*@ E-DIS (四川省)
*@ Copyright : (c) 2003
*@ Company : BOCO.
*@ 资料查询模块
*@ author LiuYang
*@ version 1.0
*@ date    2003-05-09
**/
%>
<html>
<head>
<title>显示资源信息列表</title>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<link rel="stylesheet" href="../css/style.css" type="text/css">
<script language=javascript>
//<!--
function exportToFile()
{
	excel.submit();
}
//-->
</script>
</head>
<script>
function goBack()
{
	history.go(-1);
}
</script>
<body bgcolor="#eeeeee" text="#000000" class="listStyle">
<table bgcolor="#dddddd" width='100%'>
<tr><td align=center><font size=2><B>统计列表</B></font></td>
</table>
<table bgcolor="#dddddd" width='100%' id="resultRs">
<tr bgcolor=#eeeeee><td></td>
<%
String typeid = request.getParameter("type");
String stattype = request.getParameter("stattype");
String [] city = request.getParameterValues("city");
String [] menu = request.getParameterValues("menu");
statRes sr = new statRes();
Vector temp = new Vector();
temp = sr.getStatType(typeid);
statType st = new statType();
statType sa = new statType();

String tab = null;
for(int i = 0; i < temp.size(); i ++)
{
	st = (statType)temp.get(i);
	if(st.getId() == Integer.parseInt(stattype))
	{
		tab = st.getTab()+"";
		sa = st;
	}
}
Vector tp = new Vector();
assStat as = new assStat();
Vector tmpa = new Vector();

tp = sr.getAssStat(stattype+"");
for(int a = 0; a < tp.size(); a ++)
{
	for(int i = 0; i < menu.length; i ++)
	{
		as = (assStat)tp.get(a);
		if(as.getId() == Integer.parseInt(menu[i]))
		{
			tmpa.addElement(as);
			break;
		}
	}
}
for(int a = 0; a < tmpa.size(); a++)
{
	as = (assStat)tmpa.get(a);
	out.println("<td align=center class=ttTable><font size=2>"+as.getName()+"</font></td>");
}
out.println("</tr>");
Vector ty = new Vector();
ty = sr.getTypeInfo(tab);
%>
<%
if(Integer.parseInt(tab) == 1)
{
	String sql = "";
	Vector countV = new Vector();
	Vector sumV  = new Vector();
	Vector tnn = new Vector();
	for(int i = 0; i < ty.size(); i++)
	{
		for(int a = 0; a < city.length; a ++)
		{
			publicClass pc = new publicClass();
			pc = (publicClass)ty.get(i);
			if(pc.getId() == Integer.parseInt(city[a]))
				tnn.addElement(pc);
		}
	}
	for(int i = 0; i < tnn.size(); i ++)
	{
		publicClass pc = new publicClass();
		pc = (publicClass)tnn.get(i);
		Vector count = new Vector();
		out.println("<tr bgcolor=#eeeeee><td align=center class=td><font size=2>"+pc.getName()+"</font></td>");
	
		count = sr.getCount(pc,tmpa,sa,city,typeid,stattype);		
		
		int c[] = new int[count.size()];
		for(int a = 0; a < count.size(); a++)
		{
			if(count.get(a) != null)
				c[a] = Integer.parseInt((String)count.get(a));
			else
				c[a] = 0;
				
			if(count.get(a) != null)
				out.println("<td align=center class=td><font size=2>"+count.get(a)+"</font></td>");
			else
				out.println("<td align=center class=td><font size=2>0</font></td>");
		}
		sumV = sr.sumCount(sumV,c);
		
		out.println("</tr>");
	}
	out.println("<tr bgcolor=#eeeeee><td align=center class=td><font size=2><B>总计</B></font></td>");

	for(int i = 0; i < sumV.size(); i ++)
		out.println("<td align=center class=td><font size=2><B>"+sumV.get(i)+"</B></font></td>");

	out.println("</tr>");
}
else
{
	String sql = "";
	Vector countV = new Vector();
	Vector sumV  = new Vector();
	Vector tnn = new Vector();
	for(int i = 0; i < ty.size(); i++)
	{
		for(int a = 0; a < city.length; a ++)
		{
			publicClass pc = new publicClass();
			pc = (publicClass)ty.get(i);
			if(pc.getId() == Integer.parseInt(city[a]))
				tnn.addElement(pc);
		}
	}
	for(int i = 0; i < tnn.size(); i ++)
	{
		publicClass pc = new publicClass();
		pc = (publicClass)tnn.get(i);
		Vector count = new Vector();
		out.println("<tr bgcolor=#eeeeee><td align=center class=td><font size=2>"+pc.getName()+"</font></td>");
	
		count = sr.getCount(pc,tmpa,sa,city,typeid,stattype);
		int c[] = new int[count.size()];
		for(int a = 0; a < count.size(); a++)
		{
			if(count.get(a) != null)
				c[a] = Integer.parseInt((String)count.get(a));
			else
				c[a] = 0;
			
			if(count.get(a) != null)
				out.println("<td align=center class=td><font size=2>"+count.get(a)+"</font></td>");
			else
				out.println("<td align=center class=td><font size=2>0</font></td>");
		}

		sumV = sr.sumCount(sumV,c);
		out.println("</tr>");
	}
	out.println("<tr bgcolor=#eeeeee><td align=center class=td><font size=2><B>总计</B></font></td>");
	for(int i = 0; i < sumV.size(); i ++)
		out.println("<td align=center class=td><font size=2><B>"+sumV.get(i)+"</B></font></td>");

	out.println("</tr>");
}
%>
</table>
<br>
<table>
<tr><td align=center><a href="javascript:exportToFile()">导入Excel</a></td></tr>
</table>
<form name=excel method=post action='exportStat.jsp' style='display:none'>
<input type=hidden name=type value='<%=typeid%>'>
<input type=hidden name=stattype value='<%=stattype%>'>
<select name=city multiple>
<%
for(int i = 0; i < city.length; i ++)
	out.println("<option value='"+city[i]+"' selected></option>");
%>
</select>
<select name=menu multiple>
<%
for(int i = 0; i < menu.length; i ++)
	out.println("<option value='"+menu[i]+"' selected></option>");
%>
</select>
</form>
<p align=center><font size=2><a href="javascript:goBack()">返回</a></font></p>
</body>
</html>