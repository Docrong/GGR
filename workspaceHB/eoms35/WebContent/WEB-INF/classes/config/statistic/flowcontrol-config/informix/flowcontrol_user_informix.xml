<?xml version="1.0" encoding="UTF-8"?>
<!--所有标签名称都为固定值,不能修改,否则无法解析. -->
<KpiConfig>
    <title>kpi统计</title>
    <est-module-id></est-module-id>

    <!-- 个人监控 -->
    <kpi-define><!-- 可重复 -->
        <name>bysheet</name>
        <kpi-caption></kpi-caption>

        <condition-param page-name="beginTime"/>
        <condition-param page-name="endTime"/>
        <condition-param page-name="userid"/>
        <summary-define>
            <id>s1</id>
            <sequence></sequence>
            <column>est.sheettype</column>
            <id2name-service>statDictId2name_v35</id2name-service>
        </summary-define>

        <stat-detail-vo>com.boco.eoms.commons.statistic.flowcontrol.vo.FlowcontrolDetailVO
        </stat-detail-vo><!--显示DetailVO-->

        <query-define><!-- 可重复 -->
            <name>query1</name>
            <!-- sql片段,用于jdbc统计(分子) -->
            <from>v_user_flowcontrol est</from><!-- 不可为空 -->
            <where>
                est.sendtime&gt;=extend(today-30,year to second) and est.operateuserid='@userid@'
            </where><!-- 可为空 -->
            <field-define><!-- 可重复 -->
                <id>f1</id><!--总工单数-->
                <sequence>1</sequence>
                <stat-type>field_sql</stat-type>
                <stat-sql>sum(case when est.taskstatus='2' then 1 else 0 end)</stat-sql>
                <list-hsql>
                    select
                    est.sheetkey,est.taskid,est.taskname,est.operateroleid,est.piid,est.taskstatus,est.prelinkid,est.sheetid,est.title,
                    est.sheettype,est.sendtime,est.completetimelimit from v_user_flowcontrol est where
                    est.sendtime&gt;=extend(today-30,year to second) and est.taskstatus='2' and est.sheettype='@s1@' and
                    est.operateuserid='@userid@'
                    order by est.sendtime desc
                </list-hsql>
                <list-count-select-sql>select count(est.sheetkey)</list-count-select-sql><!--列表总数-->
            </field-define>
            <field-define><!-- 可重复 -->
                <id>f2</id><!--总工单数-->
                <sequence>1</sequence>
                <stat-type>field_sql</stat-type>
                <stat-sql>sum(case when est.taskstatus='8' then 1 else 0 end)</stat-sql>
                <list-hsql>
                    select
                    est.sheetkey,est.taskid,est.taskname,est.operateroleid,est.piid,est.taskstatus,est.prelinkid,est.sheetid,est.title,
                    est.sheettype,est.sendtime,est.completetimelimit from v_user_flowcontrol est where
                    est.sendtime&gt;=extend(today-30,year to second) and est.taskstatus='8' and est.sheettype='@s1@' and
                    est.operateuserid='@userid@'
                    order by est.sendtime desc
                </list-hsql>
                <list-count-select-sql>select count(est.sheetkey)</list-count-select-sql><!--列表总数-->
            </field-define>
            <field-define><!-- 可重复 -->
                <id>f3</id><!--总工单数-->
                <sequence>1</sequence>
                <stat-type>field_sql</stat-type>
                <stat-sql>sum(case when est.taskname='HoldHumTask' then 1 else 0 end)</stat-sql>
                <list-hsql>
                    select
                    est.sheetkey,est.taskid,est.taskname,est.operateroleid,est.piid,est.taskstatus,est.prelinkid,est.sheetid,est.title,
                    est.sheettype,est.sendtime,est.completetimelimit from v_user_flowcontrol est where
                    est.sendtime&gt;=extend(today-30,year to second) and est.taskname='HoldHumTask' and
                    est.sheettype='@s1@' and est.operateuserid='@userid@'
                    order by est.sendtime desc
                </list-hsql>
                <list-count-select-sql>select count(est.sheetkey)</list-count-select-sql><!--列表总数-->
            </field-define>
            <field-define><!-- 可重复 -->
                <id>f4</id><!--总工单数-->
                <sequence>1</sequence>
                <stat-type>field_sql</stat-type>
                <stat-sql>sum(case when est.completetimelimit-current&gt;=interval(1) hour to hour and
                    est.completetimelimit-current&lt;=interval(2) hour to hour then 1 else 0 end)
                </stat-sql>
                <list-hsql>
                    select
                    est.sheetkey,est.taskid,est.taskname,est.operateroleid,est.piid,est.taskstatus,est.prelinkid,est.sheetid,est.title,
                    est.sheettype,est.sendtime,est.completetimelimit from v_user_flowcontrol est where
                    est.sendtime&gt;=extend(today-30,year to second) and est.sheettype='@s1@' and
                    est.operateuserid='@userid@' and
                    est.completetimelimit-current&gt;=interval(1) hour to hour and est.completetimelimit-current&lt;=interval(2)
                    hour to hour then 1 else 0 end)
                    order by est.sendtime desc
                </list-hsql>
                <list-count-select-sql>select count(est.sheetkey)</list-count-select-sql><!--列表总数-->
            </field-define>
            <field-define><!-- 可重复 -->
                <id>f5</id><!--总工单数-->
                <sequence>1</sequence>
                <stat-type>field_sql</stat-type>
                <stat-sql>sum(case when est.completetimelimit-current&gt;=interval(30) minute to minute and
                    est.completetimelimit-current&lt;=interval(1) hour to hour then 1 else 0 end)
                </stat-sql>
                <list-hsql>
                    select
                    est.sheetkey,est.taskid,est.taskname,est.operateroleid,est.piid,est.taskstatus,est.prelinkid,est.sheetid,est.title,
                    est.sheettype,est.sendtime,est.completetimelimit from v_user_flowcontrol est where
                    est.sendtime&gt;=extend(today-30,year to second) and est.sheettype='@s1@' and
                    est.operateuserid='@userid@' and
                    est.completetimelimit-current&gt;=interval(30) minute to minute and est.completetimelimit-current&lt;=interval(1)
                    hour to hour then 1 else 0 end)
                    order by est.sendtime desc
                </list-hsql>
                <list-count-select-sql>select count(est.sheetkey)</list-count-select-sql><!--列表总数-->
            </field-define>
            <field-define><!-- 可重复 -->
                <id>f6</id><!--总工单数-->
                <sequence>1</sequence>
                <stat-type>field_sql</stat-type>
                <stat-sql>sum(case when est.completetimelimit&gt;=current and est.completetimelimit-current&lt;=interval(30)
                    minute to minute then 1 else 0 end)
                </stat-sql>
                <list-hsql>
                    select
                    est.sheetkey,est.taskid,est.taskname,est.operateroleid,est.piid,est.taskstatus,est.prelinkid,est.sheetid,est.title,
                    est.sheettype,est.sendtime,est.completetimelimit from v_user_flowcontrol est where
                    est.sendtime&gt;=extend(today-30,year to second) and est.sheettype='@s1@' and
                    est.operateuserid='@userid@' and
                    est.completetimelimit&gt;=current and est.completetimelimit-current&lt;=interval(30) minute to
                    minute
                    order by est.sendtime desc
                </list-hsql>
                <list-count-select-sql>select count(est.sheetkey)</list-count-select-sql><!--列表总数-->
            </field-define>
            <field-define><!-- 可重复 -->
                <id>f7</id><!--总工单数-->
                <sequence>1</sequence>
                <stat-type>field_sql</stat-type>
                <stat-sql>sum(case when current&gt;est.completetimelimit then 1 else 0 end)</stat-sql>
                <list-hsql>
                    select
                    est.sheetkey,est.taskid,est.taskname,est.operateroleid,est.piid,est.taskstatus,est.prelinkid,est.sheetid,est.title,
                    est.sheettype,est.sendtime,est.completetimelimit from v_user_flowcontrol est where
                    est.sendtime&gt;=extend(today-30,year to second) and current&gt;est.completetimelimit and
                    est.sheettype='@s1@' and est.operateuserid='@userid@'
                    order by est.sendtime desc
                </list-hsql>
                <list-count-select-sql>select count(est.sheetkey)</list-count-select-sql><!--列表总数-->
            </field-define>
        </query-define>
    </kpi-define>


</KpiConfig>