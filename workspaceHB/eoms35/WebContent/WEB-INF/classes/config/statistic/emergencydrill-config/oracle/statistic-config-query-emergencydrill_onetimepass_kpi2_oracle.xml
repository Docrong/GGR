<?xml version="1.0" encoding="UTF-8"?>
<!--所有标签名称都为固定值,不能修改,否则无法解析. -->
<KpiConfig>
	<title>kpi统计</title>
	<est-module-id></est-module-id>

	

	<kpi-define><!-- 可重复 -->
		<name>onetimepassStat_kpi2</name>
		<kpi-caption></kpi-caption>

		<condition-param page-name="beginTime"/>
		<condition-param page-name="endTime"/>
		<!-- 
		<condition-param page-name="sendDeptId"/> 
		-->
		<!--
		<condition-param page-name="revDeptId" markflag="true" />
	   -->
		<summary-define>
			<id>s1</id>
			<sequence></sequence>
			<column>'aa'</column><!-- 汇总字段 -->
			<!--id2name-service>tawSystemDeptDao</id2name-service-->
			<id2name-service></id2name-service><!-- 汇总字段 id2name的beanid 这是部门ID转中文名-->
			</summary-define>
		  <auto-append-groupby>fasle</auto-append-groupby>

		<stat-detail-vo>com.boco.eoms.commons.statistic.emergencydrill.vo.EmergencydrillDetailVO</stat-detail-vo><!--显示DetailVO-->

		<query-define><!-- 可重复 -->
			<name>query1</name>
			
			<!-- sql片段,用于jdbc统计(分子) -->
			<from>emergencydrill_main main</from><!-- 不可为空 --><!--不包括草稿工单 status=3-->
			<where>
				main.status=1
		        and main.sendtime&gt;=to_date('@beginTime@','YYYY-MM-DD HH24:MI:SS') 
				and main.sendtime&lt;to_date('@endTime@','YYYY-MM-DD HH24:MI:SS')
            </where><!-- 可为空 -->


			<field-define><!-- 可重复 -->
				<id>f1</id><!--总工单数-->
				<sequence>1</sequence>

				<stat-type>field_sql</stat-type><!--"field_sql,single_sql,expression"  -->
				<stat-sql>count(distinct main.id)</stat-sql>

				<list-hsql>
					select distinct main.id as mainid,main.sheetid,main.title,main.sendtime,main.senddeptid 
					from emergencydrill_main main  
					where main.status=1
					and main.sendtime&gt;=to_date('@beginTime@','YYYY-MM-DD HH24:MI:SS') 
				    and main.sendtime&lt;to_date('@endTime@','YYYY-MM-DD HH24:MI:SS')  order by main.sendtime desc
				</list-hsql>
				
				<list-count-select-sql>select count(distinct main.id)</list-count-select-sql><!--列表总数-->
			</field-define>

		</query-define>
		
		<query-define><!-- 可重复 -->
			<name>query2</name>
			
			<!-- sql片段,用于jdbc统计(分子) -->
			<from>emergencydrill_main main</from><!-- 不可为空 --><!--不包括草稿工单 status=3-->
			<where>
				main.status=1 
				and (main.mainrejecttimes is null or  main.mainrejecttimes=0)
			    and main.sendtime&gt;=to_date('@beginTime@','YYYY-MM-DD HH24:MI:SS') 
				and main.sendtime&lt;to_date('@endTime@','YYYY-MM-DD HH24:MI:SS')
     	 	</where><!-- 可为空 -->


			<field-define><!-- 可重复 -->
				<id>f2</id><!--一次审批成功数-->
				<sequence>1</sequence>

				<stat-type>field_sql</stat-type><!--"field_sql,single_sql,expression"  -->
				<stat-sql>count(distinct main.id)</stat-sql>

				<list-hsql>
					select distinct main.id as mainid,main.sheetid,main.title,main.sendtime,main.senddeptid 
					from emergencydrill_main main  
					where main.status=1 
					and (main.mainrejecttimes is null or  main.mainrejecttimes=0)
					and main.sendtime&gt;=to_date('@beginTime@','YYYY-MM-DD HH24:MI:SS') 
					and main.sendtime&lt;to_date('@endTime@','YYYY-MM-DD HH24:MI:SS') order by main.sendtime desc
				</list-hsql>
				
				<list-count-select-sql>select count(distinct main.id)</list-count-select-sql><!--列表总数-->
			</field-define>

		</query-define>
		
			<query-define><!-- 可重复 -->
			<name>query3</name>
			
			<!-- sql片段,用于jdbc统计(分子) -->
			<from>emergencydrill_main main</from><!-- 不可为空 --><!--不包括草稿工单 status=3-->
			<where>
				main.status=1 
				and main.mainrejecttimes>0
			    and main.sendtime&gt;=to_date('@beginTime@','YYYY-MM-DD HH24:MI:SS') 
				and main.sendtime&lt;to_date('@endTime@','YYYY-MM-DD HH24:MI:SS')
      		</where><!-- 可为空 -->


			<field-define><!-- 可重复 -->
				<id>f3</id><!--审批不通过数-->
				<sequence>1</sequence>

				<stat-type>field_sql</stat-type><!--"field_sql,single_sql,expression"  -->
				<stat-sql>count(distinct main.id)</stat-sql>

				<list-hsql>
					select distinct main.id as mainid,main.sheetid,main.title,main.sendtime,main.senddeptid 
					from emergencydrill_main main  
					where main.status=1 
					and main.mainrejecttimes>0
					and main.sendtime&gt;=to_date('@beginTime@','YYYY-MM-DD HH24:MI:SS') 
				    and main.sendtime&lt;to_date('@endTime@','YYYY-MM-DD HH24:MI:SS')   order by main.sendtime desc
				</list-hsql>
				
				<list-count-select-sql>select count(distinct main.id)</list-count-select-sql><!--列表总数-->
			</field-define>

		</query-define>
		
		
	</kpi-define>	
</KpiConfig>